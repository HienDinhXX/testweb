<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n l√Ω t√†i s·∫£n</title>
<style>
body{
  font-family:-apple-system,sans-serif;
  background:#f2f2f7;
  padding:15px;
  font-size:14px;
}
.card{
  background:white;
  padding:12px;
  border-radius:12px;
  box-shadow:0 3px 8px rgba(0,0,0,0.05);
  margin-bottom:15px;
}
h2{font-size:16px;margin-bottom:8px;}
input{
  width:100%;
  padding:6px;
  margin:5px 0;
  border-radius:6px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  padding:6px 8px;
  margin-top:5px;
  border-radius:6px;
  border:none;
  font-size:12px;
}
.addBtn{background:#007AFF;color:white;width:100%;}
.editBtn{background:#ff9500;color:white;}
.deleteBtn{background:#ff3b30;color:white;}
.item{padding:6px 0;border-bottom:1px solid #eee;font-size:13px;}
.total{font-size:16px;font-weight:bold;}

#lockScreen{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:#f2f2f7;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}
</style>
</head>
<body>

<div id="lockScreen">
  <h2>üîê Nh·∫≠p m·∫≠t kh·∫©u</h2>
  <input type="password" id="pinInput">
  <button class="addBtn" onclick="checkPIN()">M·ªü</button>
  <p id="pinError" style="color:red;"></p>
</div>

<div id="app" style="display:none;">

<div class="card">
<h2>ü•á V√†ng (ƒë∆°n v·ªã: ch·ªâ)</h2>
<label>ƒê∆°n gi√° v√†ng (VND)</label>
<input type="text" id="goldPrice">
<hr>
<input type="text" id="goldName" placeholder="T√™n c·ª≠a h√†ng">
<input type="number" id="goldQty" placeholder="S·ªë l∆∞·ª£ng (ch·ªâ)">
<button class="addBtn" onclick="addGold()">Th√™m v√†ng</button>
<div id="goldList"></div>
</div>

<div class="card">
<h2>üè¶ S·ªï ti·∫øt ki·ªám c·ª©ng</h2>
<input type="text" id="bankName" placeholder="T√™n ng√¢n h√†ng">
<input type="text" id="bankAmount" placeholder="S·ªë ti·ªÅn (VND)">
<label>Ng√†y m·ªü s·ªï</label>
<input type="date" id="bankDate">
<button class="addBtn" onclick="addBank()">Th√™m ng√¢n h√†ng</button>
<div id="bankList"></div>
</div>

<div class="card">
<h2>üí≥ S·ªï ti·∫øt ki·ªám online</h2>
<input type="text" id="onlineAmountInput" placeholder="S·ªë ti·ªÅn (VND)">
<label>Ng√†y m·ªü s·ªï</label>
<input type="date" id="onlineDate">
<button class="addBtn" onclick="addOnline()">Th√™m s·ªï online</button>
<div id="onlineList"></div>
</div>

<div class="card total" id="grandTotal">
T·ªïng t√†i s·∫£n: 0 VND
</div>

</div>

<script>
let golds=[],banks=[],onlines=[];
let lockTimer;
const FIXED_PIN="981202";

/* -------- AUTO LOCK -------- */
function resetTimer(){
  clearTimeout(lockTimer);
  lockTimer=setTimeout(()=>{ lockApp(); },180000);
}
function lockApp(){
  app.style.display="none";
  lockScreen.style.display="flex";
  pinInput.value="";
}

/* -------- PIN -------- */
function checkPIN(){
  if(pinInput.value===FIXED_PIN){
    lockScreen.style.display="none";
    app.style.display="block";
    loadData();
    resetTimer();
    pinError.innerText="";
  }else{
    pinError.innerText="Sai m·∫≠t kh·∫©u!";
  }
}

/* -------- FORMAT -------- */
function formatNumber(num){
  return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");
}
function parseNumber(str){
  return Number(str.replace(/\./g,""))||0;
}

/* -------- DATA -------- */
function saveData(){
  localStorage.setItem("golds",JSON.stringify(golds));
  localStorage.setItem("banks",JSON.stringify(banks));
  localStorage.setItem("onlines",JSON.stringify(onlines));
  localStorage.setItem("goldPrice",goldPrice.value);
}
function loadData(){
  golds=JSON.parse(localStorage.getItem("golds"))||[];
  banks=JSON.parse(localStorage.getItem("banks"))||[];
  onlines=JSON.parse(localStorage.getItem("onlines"))||[];
  goldPrice.value=localStorage.getItem("goldPrice")||"";
  render();
}

/* -------- GOLD -------- */
function addGold(){
  if(!goldName.value||!goldQty.value)return;
  golds.push({name:goldName.value,qty:Number(goldQty.value)});
  goldName.value="";goldQty.value="";
  render();saveData();resetTimer();
}
function editGold(i){
  let g=golds[i];
  let n=prompt("T√™n c·ª≠a h√†ng:",g.name);
  let q=prompt("S·ªë l∆∞·ª£ng:",g.qty);
  if(n&&q){golds[i]={name:n,qty:Number(q)};render();saveData();}
}
function deleteGold(i){
  if(confirm("Xo√° m·ª•c n√†y?")){golds.splice(i,1);render();saveData();}
}

/* -------- BANK -------- */
function addBank(){
  if(!bankName.value||!bankAmount.value||!bankDate.value)return;
  banks.push({name:bankName.value,amount:parseNumber(bankAmount.value),date:bankDate.value});
  bankName.value="";bankAmount.value="";bankDate.value="";
  render();saveData();resetTimer();
}
function editBank(i){
  let b=banks[i];
  let n=prompt("T√™n ng√¢n h√†ng:",b.name);
  let a=prompt("S·ªë ti·ªÅn:",formatNumber(b.amount));
  let d=prompt("Ng√†y m·ªü:",b.date);
  if(n&&a&&d){banks[i]={name:n,amount:parseNumber(a),date:d};render();saveData();}
}
function deleteBank(i){
  if(confirm("Xo√° m·ª•c n√†y?")){banks.splice(i,1);render();saveData();}
}

/* -------- ONLINE -------- */
function addOnline(){
  if(!onlineAmountInput.value||!onlineDate.value)return;
  onlines.push({amount:parseNumber(onlineAmountInput.value),date:onlineDate.value});
  onlineAmountInput.value="";onlineDate.value="";
  render();saveData();resetTimer();
}
function editOnline(i){
  let o=onlines[i];
  let a=prompt("S·ªë ti·ªÅn:",formatNumber(o.amount));
  let d=prompt("Ng√†y m·ªü:",o.date);
  if(a&&d){onlines[i]={amount:parseNumber(a),date:d};render();saveData();}
}
function deleteOnline(i){
  if(confirm("Xo√° m·ª•c n√†y?")){onlines.splice(i,1);render();saveData();}
}

/* -------- RENDER -------- */
function render(){
  let price=parseNumber(goldPrice.value);
  goldPrice.value=price?formatNumber(price):"";

  let goldTotal=0;
  goldList.innerHTML=golds.map((g,i)=>{
    let total=g.qty*price;
    goldTotal+=total;
    return `<div class="item">
    ${g.name} - ${g.qty} ch·ªâ √ó ${formatNumber(price)} = ${formatNumber(total)} VND
    <br>
    <button class="editBtn" onclick="editGold(${i})">S·ª≠a</button>
    <button class="deleteBtn" onclick="deleteGold(${i})">Xo√°</button>
    </div>`;
  }).join("");

  let bankTotal=0;
  bankList.innerHTML=banks.map((b,i)=>{
    bankTotal+=b.amount;
    return `<div class="item">
    ${b.name} - ${formatNumber(b.amount)} VND
    <br>Ng√†y m·ªü: ${b.date}
    <br>
    <button class="editBtn" onclick="editBank(${i})">S·ª≠a</button>
    <button class="deleteBtn" onclick="deleteBank(${i})">Xo√°</button>
    </div>`;
  }).join("");

  let onlineTotal=0;
  onlineList.innerHTML=onlines.map((o,i)=>{
    onlineTotal+=o.amount;
    return `<div class="item">
    ${formatNumber(o.amount)} VND
    <br>Ng√†y m·ªü: ${o.date}
    <br>
    <button class="editBtn" onclick="editOnline(${i})">S·ª≠a</button>
    <button class="deleteBtn" onclick="deleteOnline(${i})">Xo√°</button>
    </div>`;
  }).join("");

  grandTotal.innerText="T·ªïng t√†i s·∫£n: "+
    formatNumber(goldTotal+bankTotal+onlineTotal)+" VND";
}

goldPrice.addEventListener("input",()=>{render();resetTimer();});
document.addEventListener("click",resetTimer);
document.addEventListener("keydown",resetTimer);

window.onload=function(){
  lockScreen.style.display="flex";
};
</script>

</body>
</html>
